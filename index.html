<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>6 HELLS: MOBILE FINAL</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        /* 갤럭시 전체 화면 최적화 */
        html, body { 
            height: 100%; 
            margin: 0; 
            padding: 0; 
            background: #000; 
            color: #0f0; 
            font-family: 'Malgun Gothic', sans-serif; 
            overflow: hidden; 
        }

        #game-container {
            display: flex;
            flex-direction: column;
            height: 100vh; /* 갤럭시 주소창 대응 */
            height: -webkit-fill-available;
            padding: 10px;
        }

        /* 상태바: 가독성 높임 */
        #status-bar {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: #010;
            border: 1px solid #040;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        /* 로그 영역: 버튼에 가려지지 않게 유연하게 조정 */
        #log-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 10, 0, 0.95);
            border: 1px solid #050;
            border-radius: 8px;
            margin-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }

        #log p { margin: 8px 0; line-height: 1.6; font-size: 15px; color: #ccc; }

        /* 하단 컨트롤러 영역: 무조건 하단에 고정 */
        #action-area {
            min-height: 160px;
            background: #000;
        }

        #controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        button {
            height: 60px; /* 터치하기 쉬운 크기 */
            background: #020;
            color: #0f0;
            border: 2px solid #0a0;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }

        button:active { background: #0f0; color: #000; }

        /* 특수 텍스트 효과 */
        .critical { color: #f00; font-weight: bold; }
        .erotic { color: #ff69b4; border-left: 3px solid #ff69b4; padding-left: 8px; }
        .hint-text { color: #ff0; background: #330; padding: 0 5px; border-radius: 3px; }
        .boss-speech { color: #f0f; font-weight: bold; font-style: italic; }

        input {
            width: 100%;
            height: 55px;
            background: #111;
            color: #0f0;
            border: 1px solid #0a0;
            text-align: center;
            font-size: 18px;
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-bar">
        <div>지옥: <span id="area-val">1</span>/6</div>
        <div>시간: <span id="timer-val">999</span></div>
        <div>템: <span id="inv-val">0</span></div>
    </div>

    <div id="log-container">
        <div id="log">
            <p class="critical" style="text-align:center;">[ 육도윤회: 멸망의 미궁 ]</p>
            <p>갤럭시 최적화 버전입니다. 4명의 플레이어 이름을 입력하고 지옥의 계약을 시작하세요.</p>
        </div>
    </div>

    <div id="action-area">
        <div id="setup">
            <input type="text" id="name-input" placeholder="이름1, 이름2, 이름3, 이름4">
            <button onclick="initGame()" style="width:100%;">미궁 입장</button>
        </div>
        <div id="controls" class="hidden"></div>
    </div>
</div>

<script>
    let players = [], inventory = [], timeLeft = 999, currentArea = 1, currentRoom = 1, areaCode = "", audioCtx = null;

    const stages = [null, 
        { n: "무당 바리의 사당", b: "무당 바리", s: "남성의 정기를 빨아 영생을 유지하는 타락한 무당.", ki: "녹슨 제웅", kt: "제웅을 찌르자 바리의 하혈과 함께 그녀가 소멸합니다!", rooms: ["사당 입구", "피의 제단", "음란한 침실"] },
        { n: "육욕의 선실", b: "세이렌", s: "촉수로 인간을 감싸 알을 낳는 심해의 지배자.", ki: "은빛 작살", kt: "작살이 박히자 세이렌의 자궁이 터지며 촉수들이 쏟아집니다!", rooms: ["침수 통로", "산란실"] }
    ];

    function playSfx(f) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.connect(g); g.connect(audioCtx.destination);
        osc.frequency.value = f;
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
        osc.start(); osc.stop(audioCtx.currentTime + 0.5);
    }

    function addLog(m, c='') {
        const log = document.getElementById('log');
        const p = document.createElement('p');
        if(c) p.className = c;
        p.innerHTML = "> " + m;
        log.appendChild(p);
        document.getElementById('log-container').scrollTop = log.scrollHeight;
    }

    function initGame() {
        const v = document.getElementById('name-input').value;
        if(!v) return;
        players = v.split(',').map(n => n.trim()).slice(0, 4);
        document.getElementById('setup').classList.add('hidden');
        document.getElementById('controls').classList.remove('hidden');
        playSfx(200);
        setInterval(() => { if(timeLeft > 0) { timeLeft--; document.getElementById('timer-val').innerText = timeLeft; } }, 1000);
        loadArea();
    }

    function loadArea() {
        currentRoom = 1;
        areaCode = Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('area-val').innerText = currentArea;
        addLog(`[LAYER ${currentArea}] ${stages[currentArea].n}`, 'critical');
        addLog(stages[currentArea].s);
        renderRoom();
    }

    function renderRoom() {
        const s = stages[currentArea];
        if(currentRoom <= s.rooms.length) {
            addLog(`${players[Math.floor(Math.random()*players.length)]}님이 ${s.rooms[currentRoom-1]}을(를) 조사합니다.`);
            updateButtons(["철저한 수색", "은밀한 이동", "물건 뒤지기", "함정 해제"]);
        } else {
            addLog(`<span class='boss-speech'>"감히 이곳까지... 네놈들의 육체를 분해해주마!"</span>`, 'erotic');
            updateButtons(["암호 입력", "아이템 사용", "굴복(R19)", "필사의 저항"]);
        }
    }

    function updateButtons(list) {
        const ctrl = document.getElementById('controls');
        ctrl.innerHTML = '';
        list.forEach(txt => {
            const b = document.createElement('button');
            b.innerText = txt;
            b.onclick = () => handleAction(txt);
            ctrl.appendChild(b);
        });
    }

    function handleAction(txt) {
        playSfx(400);
        if(txt === "암호 입력") {
            const a = prompt("4자리 암호:");
            if(a === areaCode) { addLog("탈출 성공!", "critical"); nextStage(); }
            else die("암호 실패. 당신들은 보스의 노리개가 됩니다.");
        } else if(txt === "아이템 사용") {
            if(inventory.includes(stages[currentArea].ki)) { addLog(stages[currentArea].kt, "critical"); nextStage(); }
            else { addLog("아이템이 없습니다!", "critical"); timeLeft -= 100; }
        } else if(txt === "굴복(R19)") {
            if(Math.random() > 0.5) { addLog("보스가 당신의 봉사에 만족해 길을 비킵니다.", "erotic"); nextStage(); }
            else die("보스는 당신을 죽을 때까지 유린했습니다.");
        } else {
            // 일반 수색 로직
            const r = Math.random();
            if(r > 0.6) {
                const hint = r > 0.8 ? areaCode.substring(0,2)+"XX" : "XX"+areaCode.substring(2,4);
                addLog(`벽면에 적힌 숫자: <span class='hint-text'>${hint}</span> (3초 후 소멸)`);
                setTimeout(() => { document.querySelectorAll('.hint-text').forEach(e => e.innerText = "####"); }, 3000);
            } else if(r > 0.3) {
                inventory.push(stages[currentArea].ki);
                addLog(`[${stages[currentArea].ki}] 획득!`);
                document.getElementById('inv-val').innerText = inventory.length;
            } else {
                addLog("아무것도 찾지 못했고, 보이지 않는 손에 유린당합니다.", "erotic");
            }
            currentRoom++;
            setTimeout(renderRoom, 800);
        }
    }

    function nextStage() {
        currentArea++;
        if(currentArea >= stages.length) {
            document.body.innerHTML = "<h1 style='color:#0f0; text-align:center; margin-top:100px;'>완전한 탈출 성공</h1>";
        } else loadArea();
    }

    function die(msg) {
        document.body.innerHTML = `<div style='color:red; text-align:center; padding:50px 20px;'><h1>BAD END</h1><p>${msg}</p><button onclick='location.reload()' style='width:100%'>다시 시작</button></div>`;
    }
</script>
</body>
</html>
