<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>뽕</title>
    <style>
        :root { --moss: #0a1f0a; --acid: #1fff41; --blood: #660000; --flesh: #ff7675; --void: #000; --paper: #c0c090; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { height: 100vh; margin: 0; background: var(--void); color: var(--acid); font-family: 'ChosunIlbo_myungjo', serif; overflow: hidden; }
        
        #ritual-frame { display: flex; flex-direction: column; height: 100%; max-width: 650px; margin: 0 auto; border: 1px solid #1a3a1a; box-shadow: 0 0 50px #052205; }
        
        /* 상단 상태창 */
        #header { display: grid; grid-template-columns: 1fr 1fr 1fr; padding: 12px; background: #001100; border-bottom: 2px solid var(--acid); font-size: 11px; text-align: center; font-weight: bold; }
        .stat-val { color: #fff; text-shadow: 0 0 5px var(--acid); }

        /* TRPG 로그창 */
        #log-window { flex: 1; overflow-y: auto; padding: 25px; background: radial-gradient(circle at center, #051a05 0%, #000 100%); line-height: 2.3; scroll-behavior: smooth; }
        .entry { margin-bottom: 40px; animation: blurIn 1.2s ease; border-left: 2px solid #1a3a1a; padding-left: 15px; position: relative; }
        .narration { color: #888; font-style: italic; font-size: 14px; display: block; margin-bottom: 5px; }
        .dialogue { color: #fff; font-weight: bold; font-size: 18px; text-shadow: 2px 2px 2px #000; display: block; margin-bottom: 10px; }
        .scene-text { color: #d0d0d0; font-size: 16px; white-space: pre-wrap; }
        .gore-box { color: var(--flesh); background: rgba(102, 0, 0, 0.3); padding: 15px; border: 1px dashed var(--blood); margin: 15px 0; font-size: 14px; border-radius: 5px; }

        /* 인벤토리 (유물 기록) */
        #inv-label { font-size: 9px; padding: 5px 15px; color: #2d5a2d; background: #000; letter-spacing: 2px; }
        #inv-slots { display: flex; gap: 10px; padding: 15px; background: #020a02; border-top: 1px solid #1a331a; overflow-x: auto; min-height: 95px; }
        .artifact { min-width: 80px; height: 80px; border: 1px solid var(--acid); display: flex; align-items: center; justify-content: center; font-size: 11px; text-align: center; cursor: pointer; background: #000; transition: 0.3s; padding: 8px; }
        .artifact:hover { background: var(--acid); color: #000; box-shadow: 0 0 15px var(--acid); }

        /* 컨트롤 패널 */
        #action-panel { padding: 20px; background: #000; border-top: 1px solid #1a3a1a; }
        #choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { height: 60px; background: #000; color: var(--acid); border: 1px solid var(--acid); cursor: pointer; font-size: 14px; font-weight: bold; font-family: inherit; transition: 0.2s; }
        button:active { background: var(--acid); color: #000; }

        /* 모달 팝업 */
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.99); z-index: 1000; justify-content: center; align-items: center; padding: 25px; }
        #modal-content { background: #111; border: 1px solid #666; color: var(--paper); padding: 35px; width: 100%; max-width: 480px; line-height: 2; box-shadow: 0 0 50px #1a0000; border-radius: 10px; }

        @keyframes blurIn { from { opacity: 0; filter: blur(15px); transform: translateY(10px); } to { opacity: 1; filter: blur(0); transform: translateY(0); } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<audio id="snd-bgm" loop><source src="https://actions.google.com/sounds/v1/horror/dark_ritual_ambience.ogg" type="audio/ogg"></audio>
<audio id="snd-flesh"><source src="https://actions.google.com/sounds/v1/horror/creature_vocalizing.ogg" type="audio/ogg"></audio>
<audio id="snd-whisper"><source src="https://actions.google.com/sounds/v1/horror/ghost_whispers.ogg" type="audio/ogg"></audio>
<audio id="snd-hit"><source src="https://actions.google.com/sounds/v1/horror/wood_creak_close.ogg" type="audio/ogg"></audio>

<div id="ritual-frame">
    <div id="header">
        <div>육신: <span id="ui-hp" class="stat-val">100</span>%</div>
        <div>이성: <span id="ui-san" class="stat-val">100</span>%</div>
        <div>심연: <span id="ui-l" class="stat-val">1</span>/6</div>
    </div>
    
    <div id="log-window">
        <div class="entry" style="text-align:center;">
            <h1 style="color:white; letter-spacing:8px;">뽕</h1>
            <p class="scene-text">귀를 기울이십시오. 소리는 죽음의 전조입니다.</p>
        </div>
    </div>
    
    <div id="inv-label">TABOO ARTIFACTS</div>
    <div id="inv-slots"></div>

    <div id="action-panel">
        <div id="start-screen">
            <input type="text" id="p-name" placeholder="제물의 성함" style="width:100%; height:55px; background:black; border:1px solid var(--acid); color:white; text-align:center; margin-bottom:15px; font-size:16px;">
            <button onclick="ritualBegin()" style="width:100%;">소리와 함께 의식 시작</button>
        </div>
        <div id="choice-grid" class="hidden"></div>
    </div>
</div>

<div id="modal" onclick="this.style.display='none'"><div id="modal-content"></div></div>

<script>
    let pName = "", hp = 100, san = 100, layer = 1, room = 1, inv = [];
    const log = document.getElementById('log-window');

    const sfx = {
        bgm: document.getElementById('snd-bgm'),
        flesh: document.getElementById('snd-flesh'),
        whisper: document.getElementById('snd-whisper'),
        hit: document.getElementById('snd-hit')
    };

    const scenario = [null,
        { 
            name: "통곡의 무당 사당", boss: "무당 바리",
            rooms: [
                "사방이 눅눅한 초록색 이끼로 뒤덮여 있습니다. 자세히 보니 이끼가 아니라 사람의 피부 위에 핀 곰팡이입니다. 천장에서는 거세된 사내들이 매달려 끊임없이 비릿한 액체를 당신의 머리 위로 쏟아내고 있습니다.",
                "무당 바리가 날이 선 작두 위에서 나체로 춤을 추며 당신의 '성적 수치심'을 제물로 요구합니다. 그녀의 뱀 같은 혀가 당신의 귓가를 핥으며 음탕한 주술을 속삭입니다.",
                "방 한가운데 거대한 태아 모양의 가마솥이 끓고 있습니다. 그 안에는 녹아내린 인간의 성기와 내장들이 뒤섞여 기괴한 악취를 풍기며, 그 거품 속에서 무언가 반짝이는 유물이 보입니다.",
                "바리가 당신의 손에 녹슬고 날카로운 칼을 쥐어줍니다. 문을 열기 위해서는 당신의 손가락 하나, 혹은 옆에 있는 동료의 눈알 하나가 필요하다고 깔깔거리며 웃습니다.",
                "바리의 교성 섞인 주술 소리가 고막을 찢을 듯 커집니다. 그녀가 작두에서 내려와 당신의 목을 노리고 거대한 칼을 휘두르기 시작합니다!"
            ],
            events: [
                { q: "어떻게 하시겠습니까?", o: ["손가락을 스스로 자른다", "동료의 눈을 찌른다", "바리의 발치를 핥는다"], r: "choice" },
                { q: "가마솥 안의 유물을 꺼내시겠습니까?", o: ["손을 집어넣는다", "무시한다"], itm: {n: "인피 양피지", c: "바리는 고개를 빳빳이 든 자의 눈을 가장 먼저 도려낸다. 그녀가 칼을 높이 쳐들 때, 바닥에 고인 오물 속에 당신의 얼굴을 처박아라. 비천하게 기는 자만이 살아남으리라."} }
            ],
            bossAns: "오물 속에 기어간다"
        }
    ];

    function writeEntry(author, text, story, gore="") {
        const div = document.createElement('div');
        div.className = 'entry';
        div.innerHTML = `
            <span class="narration">${story}</span>
            <span class="dialogue">${author}</span>
            <p class="scene-text">${text}</p>
            ${gore ? `<div class="gore-box">${gore}</div>` : ''}
        `;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
    }

    function ritualBegin() {
        pName = document.getElementById('p-name').value || "제물";
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('choice-grid').classList.remove('hidden');
        
        // 브라우저 정책상 사용자 클릭 후 오디오 재생 가능
        sfx.bgm.volume = 0.4;
        sfx.bgm.play().catch(e => console.log("Audio Error"));
        
        writeEntry("SYSTEM", `${pName}, 당신은 이제 돌아갈 수 없습니다.`, "의식의 시작");
        renderStage();
    }

    function renderStage() {
        const stage = scenario[layer] || scenario[1];
        document.getElementById('ui-hp').innerText = hp;
        document.getElementById('ui-san').innerText = san;
        document.getElementById('ui-l').innerText = layer;

        if (room <= 4) {
            const desc = stage.rooms[room-1];
            const ev = stage.events[room % 2 === 0 ? 1 : 0];
            writeEntry(room % 2 === 0 ? "나레이션" : stage.boss, desc, `[${stage.name} - ${room}관문]`);
            updateButtons(ev.o);
        } else {
            writeEntry(stage.boss, "네 육신에서 영혼을 발라내어 신의 정액으로 쓰겠다!", "BOSS BATTLE", "인벤토리의 유물을 확인하여 생존법을 찾으십시오.");
            updateButtons(["오물 속에 기어간다", "하늘을 우러른다", "등을 돌린다", "그녀를 안는다"]);
        }
    }

    function updateButtons(list) {
        const grid = document.getElementById('choice-grid'); grid.innerHTML = '';
        list.forEach(t => {
            const b = document.createElement('button');
            b.innerText = t;
            b.onclick = () => handleChoice(t);
            grid.appendChild(b);
        });
    }

    function handleChoice(act) {
        const stage = scenario[layer] || scenario[1];
        
        if (room === 5) {
            if (act === stage.bossAns) {
                sfx.whisper.play();
                writeEntry("SYSTEM", "비참하게 살아남았습니다. 다음 지옥의 문이 열립니다.", "생존 성공");
                layer++; room = 1; inv = []; document.getElementById('inv-slots').innerHTML = '';
                if(layer > 6) { finishGame(); return; }
            } else {
                damage(40, 40, "보스의 칼날이 당신의 어깨와 척추를 가릅니다! 비명이 사당을 가득 채웁니다.");
            }
        } else if (act.includes("자른다") || act.includes("찌른다")) {
            damage(25, 15, "선혈이 뿜어져 나옵니다. 뜨겁고 끈적한 액체가 바닥을 적십니다.");
        } else if (act.includes("핥는다")) {
            damage(0, 30, "수치심에 영혼이 타락합니다. 하지만 육신은 보존되었습니다.");
        } else if (act.includes("손을 집어넣는다")) {
            damage(15, 5, "가마솥의 끓는 물에 살이 익어가는 소리가 들립니다.");
            addInv(stage.events.find(e=>e.itm).itm);
        }

        if(hp > 0 && san > 0) { room = room % 5 + 1; setTimeout(renderStage, 800); }
    }

    function damage(h, s, msg) {
        hp -= h; san -= s;
        sfx.flesh.currentTime = 0; sfx.flesh.play();
        sfx.hit.play();
        writeEntry("고통의 각인", msg, "상태 변화", `육신 손상: -${h}% / 정신 오염: -${s}%`);
        
        if (hp <= 0 || san <= 0) {
            writeEntry("END", "당신의 육신은 이끼의 양분이 되었고, 영혼은 보스의 노리개가 되었습니다.", "GAME OVER");
            document.getElementById('choice-grid').innerHTML = '<button onclick="location.reload()">다시 태어나기</button>';
        }
    }

    function addInv(item) {
        if(inv.some(i=>i.n === item.n)) return;
        sfx.whisper.play();
        inv.push(item);
        const b = document.createElement('div');
        b.className = 'artifact'; b.innerText = item.n;
        b.onclick = () => {
            sfx.whisper.volume = 0.3; sfx.whisper.play();
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('modal-content').innerHTML = `<h3>[ ${item.n} ]</h3><p>${item.c}</p>`;
        };
        document.getElementById('inv-slots').appendChild(b);
    }

    function finishGame() {
        writeEntry("TRUE ENDING", "당신은 모든 인간성을 버리고 어둠의 신이 되었습니다. 이제 당신이 의식을 주관할 차례입니다.", "심연의 왕");
        document.getElementById('choice-grid').innerHTML = '<button onclick="location.reload()">처음으로</button>';
    }
</script>
</body>
</html>
